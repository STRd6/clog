// Generated by CoffeeScript 1.6.3
(function() {
  var churn, execSync, fs, read, report, rules, score, tokens,
    __slice = [].slice;

  execSync = require("execSync");

  tokens = require("coffee-script").tokens;

  rules = require("../lib/rules").rules;

  fs = require("fs");

  read = function(path) {
    return fs.readFileSync(path, "utf8");
  };

  churn = function(filePath, cb) {
    var output;
    output = execSync.exec("git whatchanged " + filePath + " | grep 'commit' | wc -l");
    return parseInt(output.stdout, 10);
  };

  score = function(filePath) {
    var file;
    file = read(filePath);
    return tokens(file).reduce(function(sum, token) {
      var type;
      type = token[0];
      return sum + (rules[type] || 0);
    }, 0);
  };

  report = function() {
    var filePaths;
    filePaths = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    return filePaths.reduce(function(hash, file) {
      hash[file] = score(file);
      return hash;
    }, {});
  };

  exports.clog = {
    churn: churn,
    score: score,
    report: report
  };

}).call(this);
